import prompts from 'prompts';
import semver from 'semver';
export function getVersions({ current, remote }) {
    const currentVersion = current.version;
    const remoteVersion = remote && typeof remote.version === 'string' ? remote.version : undefined;
    return { currentVersion, remoteVersion };
}
export async function selectPublishOptions({ publishOptions, skipSelection, }) {
    const availablePublishOptions = Array.from(publishOptions.values())
        .map((publishOption) => ({
        ...publishOption,
        ...getVersions(publishOption),
    }))
        .filter(({ currentVersion, remoteVersion }) => !remoteVersion || semver.gt(currentVersion, remoteVersion));
    if (availablePublishOptions.length === 0) {
        return [];
    }
    else if (skipSelection) {
        return availablePublishOptions;
    }
    else {
        const answer = await prompts({
            type: 'multiselect',
            name: 'publishOptions',
            message: 'Select packages to publish',
            choices: availablePublishOptions.map(({ name, tag, currentVersion, remoteVersion }) => {
                return {
                    title: remoteVersion
                        ? `${name}@${tag} (${remoteVersion} → ${currentVersion})`
                        : `${name}@${tag} (→ ${currentVersion})`,
                    value: name,
                    disabled: remoteVersion && semver.lte(currentVersion, remoteVersion),
                };
            }),
        });
        const filter = new Set(answer.publishOptions);
        return Array.from(availablePublishOptions.values()).filter((publishOption) => filter.has(publishOption.name));
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VsZWN0UHVibGlzaE9wdGlvbnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvQHNzZW4vcHVibGlzaC1wYWNrYWdlcy9zZWxlY3RQdWJsaXNoT3B0aW9ucy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLE9BQW9CLE1BQU0sU0FBUyxDQUFDO0FBQzNDLE9BQU8sTUFBTSxNQUFNLFFBQVEsQ0FBQztBQVU1QixNQUFNLFVBQVUsV0FBVyxDQUFDLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBaUI7SUFDNUQsTUFBTSxjQUFjLEdBQVcsT0FBTyxDQUFDLE9BQVEsQ0FBQztJQUNoRCxNQUFNLGFBQWEsR0FDakIsTUFBTSxJQUFJLE9BQU8sTUFBTSxDQUFDLE9BQU8sS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztJQUM1RSxPQUFPLEVBQUUsY0FBYyxFQUFFLGFBQWEsRUFBRSxDQUFDO0FBQzNDLENBQUM7QUFPRCxNQUFNLENBQUMsS0FBSyxVQUFVLG9CQUFvQixDQUFDLEVBQ3pDLGNBQWMsRUFDZCxhQUFhLEdBQ047SUFDUCxNQUFNLHVCQUF1QixHQUFvQyxLQUFLLENBQUMsSUFBSSxDQUN6RSxjQUFjLENBQUMsTUFBTSxFQUFFLENBQ3hCO1NBQ0UsR0FBRyxDQUFDLENBQUMsYUFBYSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3ZCLEdBQUcsYUFBYTtRQUNoQixHQUFHLFdBQVcsQ0FBQyxhQUFhLENBQUM7S0FDOUIsQ0FBQyxDQUFDO1NBQ0YsTUFBTSxDQUNMLENBQUMsRUFBRSxjQUFjLEVBQUUsYUFBYSxFQUFFLEVBQUUsRUFBRSxDQUNwQyxDQUFDLGFBQWEsSUFBSSxNQUFNLENBQUMsRUFBRSxDQUFDLGNBQWMsRUFBRSxhQUFhLENBQUMsQ0FDN0QsQ0FBQztJQUVKLElBQUksdUJBQXVCLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtRQUN4QyxPQUFPLEVBQUUsQ0FBQztLQUNYO1NBQU0sSUFBSSxhQUFhLEVBQUU7UUFDeEIsT0FBTyx1QkFBdUIsQ0FBQztLQUNoQztTQUFNO1FBQ0wsTUFBTSxNQUFNLEdBQThCLE1BQU0sT0FBTyxDQUFtQjtZQUN4RSxJQUFJLEVBQUUsYUFBYTtZQUNuQixJQUFJLEVBQUUsZ0JBQWdCO1lBQ3RCLE9BQU8sRUFBRSw0QkFBNEI7WUFDckMsT0FBTyxFQUFFLHVCQUF1QixDQUFDLEdBQUcsQ0FDbEMsQ0FBQyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsY0FBYyxFQUFFLGFBQWEsRUFBRSxFQUFFLEVBQUU7Z0JBQy9DLE9BQU87b0JBQ0wsS0FBSyxFQUFFLGFBQWE7d0JBQ2xCLENBQUMsQ0FBQyxHQUFHLElBQUksSUFBSSxHQUFHLEtBQUssYUFBYSxNQUFNLGNBQWMsR0FBRzt3QkFDekQsQ0FBQyxDQUFDLEdBQUcsSUFBSSxJQUFJLEdBQUcsT0FBTyxjQUFjLEdBQUc7b0JBQzFDLEtBQUssRUFBRSxJQUFJO29CQUNYLFFBQVEsRUFDTixhQUFhLElBQUksTUFBTSxDQUFDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsYUFBYSxDQUFDO2lCQUM3RCxDQUFDO1lBQ0osQ0FBQyxDQUNGO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsTUFBTSxNQUFNLEdBQWdCLElBQUksR0FBRyxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUUzRCxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQ2YsdUJBQXVCLENBQUMsTUFBTSxFQUFFLENBQ2pDLENBQUMsTUFBTSxDQUFDLENBQUMsYUFBYSxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0tBQzdEO0FBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBwcm9tcHRzLCB7IEFuc3dlcnMgfSBmcm9tICdwcm9tcHRzJztcbmltcG9ydCBzZW12ZXIgZnJvbSAnc2VtdmVyJztcbmltcG9ydCB7IFB1Ymxpc2hPcHRpb24gfSBmcm9tICcuL3R5cGVzJztcblxuaW50ZXJmYWNlIFZlcnNpb25JbmZvIHtcbiAgY3VycmVudFZlcnNpb246IHN0cmluZztcbiAgcmVtb3RlVmVyc2lvbjogc3RyaW5nIHwgdW5kZWZpbmVkO1xufVxuXG5leHBvcnQgdHlwZSBBdmFpbGFibGVQdWJsaXNoT3B0aW9uID0gUHVibGlzaE9wdGlvbiAmIFZlcnNpb25JbmZvO1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0VmVyc2lvbnMoeyBjdXJyZW50LCByZW1vdGUgfTogUHVibGlzaE9wdGlvbik6IFZlcnNpb25JbmZvIHtcbiAgY29uc3QgY3VycmVudFZlcnNpb246IHN0cmluZyA9IGN1cnJlbnQudmVyc2lvbiE7XG4gIGNvbnN0IHJlbW90ZVZlcnNpb246IHN0cmluZyB8IHVuZGVmaW5lZCA9XG4gICAgcmVtb3RlICYmIHR5cGVvZiByZW1vdGUudmVyc2lvbiA9PT0gJ3N0cmluZycgPyByZW1vdGUudmVyc2lvbiA6IHVuZGVmaW5lZDtcbiAgcmV0dXJuIHsgY3VycmVudFZlcnNpb24sIHJlbW90ZVZlcnNpb24gfTtcbn1cblxuaW50ZXJmYWNlIFBhcmFtcyB7XG4gIHB1Ymxpc2hPcHRpb25zOiBNYXA8c3RyaW5nLCBQdWJsaXNoT3B0aW9uPjtcbiAgc2tpcFNlbGVjdGlvbjogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlbGVjdFB1Ymxpc2hPcHRpb25zKHtcbiAgcHVibGlzaE9wdGlvbnMsXG4gIHNraXBTZWxlY3Rpb24sXG59OiBQYXJhbXMpOiBQcm9taXNlPEF2YWlsYWJsZVB1Ymxpc2hPcHRpb25bXT4ge1xuICBjb25zdCBhdmFpbGFibGVQdWJsaXNoT3B0aW9uczogKFB1Ymxpc2hPcHRpb24gJiBWZXJzaW9uSW5mbylbXSA9IEFycmF5LmZyb20oXG4gICAgcHVibGlzaE9wdGlvbnMudmFsdWVzKCksXG4gIClcbiAgICAubWFwKChwdWJsaXNoT3B0aW9uKSA9PiAoe1xuICAgICAgLi4ucHVibGlzaE9wdGlvbixcbiAgICAgIC4uLmdldFZlcnNpb25zKHB1Ymxpc2hPcHRpb24pLFxuICAgIH0pKVxuICAgIC5maWx0ZXIoXG4gICAgICAoeyBjdXJyZW50VmVyc2lvbiwgcmVtb3RlVmVyc2lvbiB9KSA9PlxuICAgICAgICAhcmVtb3RlVmVyc2lvbiB8fCBzZW12ZXIuZ3QoY3VycmVudFZlcnNpb24sIHJlbW90ZVZlcnNpb24pLFxuICAgICk7XG5cbiAgaWYgKGF2YWlsYWJsZVB1Ymxpc2hPcHRpb25zLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiBbXTtcbiAgfSBlbHNlIGlmIChza2lwU2VsZWN0aW9uKSB7XG4gICAgcmV0dXJuIGF2YWlsYWJsZVB1Ymxpc2hPcHRpb25zO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IGFuc3dlcjogQW5zd2VyczwncHVibGlzaE9wdGlvbnMnPiA9IGF3YWl0IHByb21wdHM8J3B1Ymxpc2hPcHRpb25zJz4oe1xuICAgICAgdHlwZTogJ211bHRpc2VsZWN0JyxcbiAgICAgIG5hbWU6ICdwdWJsaXNoT3B0aW9ucycsXG4gICAgICBtZXNzYWdlOiAnU2VsZWN0IHBhY2thZ2VzIHRvIHB1Ymxpc2gnLFxuICAgICAgY2hvaWNlczogYXZhaWxhYmxlUHVibGlzaE9wdGlvbnMubWFwKFxuICAgICAgICAoeyBuYW1lLCB0YWcsIGN1cnJlbnRWZXJzaW9uLCByZW1vdGVWZXJzaW9uIH0pID0+IHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGl0bGU6IHJlbW90ZVZlcnNpb25cbiAgICAgICAgICAgICAgPyBgJHtuYW1lfUAke3RhZ30gKCR7cmVtb3RlVmVyc2lvbn0g4oaSICR7Y3VycmVudFZlcnNpb259KWBcbiAgICAgICAgICAgICAgOiBgJHtuYW1lfUAke3RhZ30gKOKGkiAke2N1cnJlbnRWZXJzaW9ufSlgLFxuICAgICAgICAgICAgdmFsdWU6IG5hbWUsXG4gICAgICAgICAgICBkaXNhYmxlZDpcbiAgICAgICAgICAgICAgcmVtb3RlVmVyc2lvbiAmJiBzZW12ZXIubHRlKGN1cnJlbnRWZXJzaW9uLCByZW1vdGVWZXJzaW9uKSxcbiAgICAgICAgICB9O1xuICAgICAgICB9LFxuICAgICAgKSxcbiAgICB9KTtcblxuICAgIGNvbnN0IGZpbHRlcjogU2V0PHN0cmluZz4gPSBuZXcgU2V0KGFuc3dlci5wdWJsaXNoT3B0aW9ucyk7XG5cbiAgICByZXR1cm4gQXJyYXkuZnJvbShcbiAgICAgIGF2YWlsYWJsZVB1Ymxpc2hPcHRpb25zLnZhbHVlcygpLFxuICAgICkuZmlsdGVyKChwdWJsaXNoT3B0aW9uKSA9PiBmaWx0ZXIuaGFzKHB1Ymxpc2hPcHRpb24ubmFtZSkpO1xuICB9XG59XG4iXX0=