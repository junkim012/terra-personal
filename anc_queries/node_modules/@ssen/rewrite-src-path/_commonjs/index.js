"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.rewriteSrcPath = void 0;
const path_1 = __importDefault(require("path"));
function toPackageName(fullPath) {
    const p = fullPath.replace(/\\/g, '/');
    if (/^@/.test(p)) {
        return p.split('/').splice(0, 2).join('/');
    }
    else {
        return p.split('/')[0];
    }
}
function rewriteSrcPath({ importPath, filePath, rootDir }) {
    if (/^\.\./.test(importPath)) {
        const dir = path_1.default.dirname(filePath);
        const targetFilePath = path_1.default.join(dir, importPath);
        const packageName = toPackageName(path_1.default.relative(rootDir, filePath));
        const targetPackageName = toPackageName(path_1.default.relative(rootDir, targetFilePath));
        return packageName !== targetPackageName ? targetPackageName : importPath;
    }
    return importPath;
}
exports.rewriteSrcPath = rewriteSrcPath;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvQHNzZW4vcmV3cml0ZS1zcmMtcGF0aC9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxnREFBd0I7QUFheEIsU0FBUyxhQUFhLENBQUMsUUFBZ0I7SUFDckMsTUFBTSxDQUFDLEdBQVcsUUFBUSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDL0MsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFO1FBQ2hCLE9BQU8sQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztLQUM1QztTQUFNO1FBQ0wsT0FBTyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0tBQ3hCO0FBQ0gsQ0FBQztBQUVELFNBQWdCLGNBQWMsQ0FBQyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFVO0lBQ3RFLElBQUksT0FBTyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBRTtRQUM1QixNQUFNLEdBQUcsR0FBVyxjQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzNDLE1BQU0sY0FBYyxHQUFXLGNBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBQzFELE1BQU0sV0FBVyxHQUFXLGFBQWEsQ0FBQyxjQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBQzVFLE1BQU0saUJBQWlCLEdBQVcsYUFBYSxDQUM3QyxjQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sRUFBRSxjQUFjLENBQUMsQ0FDdkMsQ0FBQztRQUVGLE9BQU8sV0FBVyxLQUFLLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDO0tBQzNFO0lBRUQsT0FBTyxVQUFVLENBQUM7QUFDcEIsQ0FBQztBQWJELHdDQWFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5cbmludGVyZmFjZSBQYXJhbXMge1xuICAvKiogaW1wb3J0ICcuLmEnICovXG4gIGltcG9ydFBhdGg6IHN0cmluZztcblxuICAvKiogYWJzb2x1dGUgZmlsZSBwYXRoICovXG4gIGZpbGVQYXRoOiBzdHJpbmc7XG5cbiAgLyoqIGFic29sdXRlIHNyYyBkaXJlY3RvcnkgcGF0aCAqL1xuICByb290RGlyOiBzdHJpbmc7XG59XG5cbmZ1bmN0aW9uIHRvUGFja2FnZU5hbWUoZnVsbFBhdGg6IHN0cmluZyk6IHN0cmluZyB7XG4gIGNvbnN0IHA6IHN0cmluZyA9IGZ1bGxQYXRoLnJlcGxhY2UoL1xcXFwvZywgJy8nKTtcbiAgaWYgKC9eQC8udGVzdChwKSkge1xuICAgIHJldHVybiBwLnNwbGl0KCcvJykuc3BsaWNlKDAsIDIpLmpvaW4oJy8nKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gcC5zcGxpdCgnLycpWzBdO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZXdyaXRlU3JjUGF0aCh7IGltcG9ydFBhdGgsIGZpbGVQYXRoLCByb290RGlyIH06IFBhcmFtcykge1xuICBpZiAoL15cXC5cXC4vLnRlc3QoaW1wb3J0UGF0aCkpIHtcbiAgICBjb25zdCBkaXI6IHN0cmluZyA9IHBhdGguZGlybmFtZShmaWxlUGF0aCk7XG4gICAgY29uc3QgdGFyZ2V0RmlsZVBhdGg6IHN0cmluZyA9IHBhdGguam9pbihkaXIsIGltcG9ydFBhdGgpO1xuICAgIGNvbnN0IHBhY2thZ2VOYW1lOiBzdHJpbmcgPSB0b1BhY2thZ2VOYW1lKHBhdGgucmVsYXRpdmUocm9vdERpciwgZmlsZVBhdGgpKTtcbiAgICBjb25zdCB0YXJnZXRQYWNrYWdlTmFtZTogc3RyaW5nID0gdG9QYWNrYWdlTmFtZShcbiAgICAgIHBhdGgucmVsYXRpdmUocm9vdERpciwgdGFyZ2V0RmlsZVBhdGgpLFxuICAgICk7XG5cbiAgICByZXR1cm4gcGFja2FnZU5hbWUgIT09IHRhcmdldFBhY2thZ2VOYW1lID8gdGFyZ2V0UGFja2FnZU5hbWUgOiBpbXBvcnRQYXRoO1xuICB9XG5cbiAgcmV0dXJuIGltcG9ydFBhdGg7XG59XG4iXX0=