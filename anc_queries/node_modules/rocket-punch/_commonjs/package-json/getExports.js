"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getExports = void 0;
const promised_1 = require("@ssen/promised");
async function getExports(exports, outDir) {
    const result = await promised_1.glob(`**/*`, {
        cwd: outDir,
        nodir: true,
        ignore: ['**/*.d.ts', '**/*.js.map', 'public/*', 'bin/*'],
    });
    const files = new Set(result);
    const moduleDirectory = exports.main === 'module' ? '.' : './_module';
    const commonjsDirectory = exports.main === 'module' ? './_commonjs' : '.';
    const secondary = exports.main === 'module' ? 'commonjs' : 'module';
    const entry = result.filter((file) => !file.startsWith('_commonjs') &&
        !file.startsWith('_module') &&
        file !== 'index.js');
    const entryExports = {};
    for (const file of entry) {
        const key = `./${file.replace(/.js$/, '')}`;
        if (!files.has(`_${secondary}/${file}`)) {
            entryExports[key] = `./${file}`;
            continue;
        }
        entryExports[key] = {
            import: `${moduleDirectory}/${file}`,
            require: `${commonjsDirectory}/${file}`,
            node: `${commonjsDirectory}/${file}`,
            default: `${moduleDirectory}/${file}`,
        };
        entryExports[key + '.js'] = {
            import: `${moduleDirectory}/${file}`,
            require: `${commonjsDirectory}/${file}`,
            node: `${commonjsDirectory}/${file}`,
            default: `${moduleDirectory}/${file}`,
        };
        if (/\/index$/.test(key)) {
            entryExports[key.replace(/\/index$/, '')] = {
                import: `${moduleDirectory}/${file}`,
                require: `${commonjsDirectory}/${file}`,
                node: `${commonjsDirectory}/${file}`,
                default: `${moduleDirectory}/${file}`,
            };
        }
    }
    return {
        '.': {
            import: `${moduleDirectory}/index.js`,
            require: `${commonjsDirectory}/index.js`,
            node: `${commonjsDirectory}/index.js`,
            default: `${moduleDirectory}/index.js`,
        },
        './public/*': './public/*',
        ...entryExports,
    };
}
exports.getExports = getExports;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2V0RXhwb3J0cy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9yb2NrZXQtcHVuY2gvcGFja2FnZS1qc29uL2dldEV4cG9ydHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsNkNBQXNDO0FBSS9CLEtBQUssVUFBVSxVQUFVLENBQzlCLE9BQStCLEVBQy9CLE1BQWM7SUFFZCxNQUFNLE1BQU0sR0FBRyxNQUFNLGVBQUksQ0FBQyxNQUFNLEVBQUU7UUFDaEMsR0FBRyxFQUFFLE1BQU07UUFDWCxLQUFLLEVBQUUsSUFBSTtRQUNYLE1BQU0sRUFBRSxDQUFDLFdBQVcsRUFBRSxhQUFhLEVBQUUsVUFBVSxFQUFFLE9BQU8sQ0FBQztLQUMxRCxDQUFDLENBQUM7SUFFSCxNQUFNLEtBQUssR0FBRyxJQUFJLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUU5QixNQUFNLGVBQWUsR0FBRyxPQUFPLENBQUMsSUFBSSxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUM7SUFDdEUsTUFBTSxpQkFBaUIsR0FBRyxPQUFPLENBQUMsSUFBSSxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUM7SUFDMUUsTUFBTSxTQUFTLEdBQUcsT0FBTyxDQUFDLElBQUksS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDO0lBRXBFLE1BQU0sS0FBSyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQ3pCLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FDUCxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDO1FBQzdCLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUM7UUFDM0IsSUFBSSxLQUFLLFVBQVUsQ0FDdEIsQ0FBQztJQUVGLE1BQU0sWUFBWSxHQUEyQixFQUFFLENBQUM7SUFFaEQsS0FBSyxNQUFNLElBQUksSUFBSSxLQUFLLEVBQUU7UUFDeEIsTUFBTSxHQUFHLEdBQUcsS0FBSyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDO1FBRTVDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLElBQUksU0FBUyxJQUFJLElBQUksRUFBRSxDQUFDLEVBQUU7WUFDdkMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEtBQUssSUFBSSxFQUFFLENBQUM7WUFDaEMsU0FBUztTQUNWO1FBRUQsWUFBWSxDQUFDLEdBQUcsQ0FBQyxHQUFHO1lBQ2xCLE1BQU0sRUFBRSxHQUFHLGVBQWUsSUFBSSxJQUFJLEVBQUU7WUFDcEMsT0FBTyxFQUFFLEdBQUcsaUJBQWlCLElBQUksSUFBSSxFQUFFO1lBQ3ZDLElBQUksRUFBRSxHQUFHLGlCQUFpQixJQUFJLElBQUksRUFBRTtZQUNwQyxPQUFPLEVBQUUsR0FBRyxlQUFlLElBQUksSUFBSSxFQUFFO1NBQ3RDLENBQUM7UUFFRixZQUFZLENBQUMsR0FBRyxHQUFHLEtBQUssQ0FBQyxHQUFHO1lBQzFCLE1BQU0sRUFBRSxHQUFHLGVBQWUsSUFBSSxJQUFJLEVBQUU7WUFDcEMsT0FBTyxFQUFFLEdBQUcsaUJBQWlCLElBQUksSUFBSSxFQUFFO1lBQ3ZDLElBQUksRUFBRSxHQUFHLGlCQUFpQixJQUFJLElBQUksRUFBRTtZQUNwQyxPQUFPLEVBQUUsR0FBRyxlQUFlLElBQUksSUFBSSxFQUFFO1NBQ3RDLENBQUM7UUFFRixJQUFJLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDeEIsWUFBWSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUc7Z0JBQzFDLE1BQU0sRUFBRSxHQUFHLGVBQWUsSUFBSSxJQUFJLEVBQUU7Z0JBQ3BDLE9BQU8sRUFBRSxHQUFHLGlCQUFpQixJQUFJLElBQUksRUFBRTtnQkFDdkMsSUFBSSxFQUFFLEdBQUcsaUJBQWlCLElBQUksSUFBSSxFQUFFO2dCQUNwQyxPQUFPLEVBQUUsR0FBRyxlQUFlLElBQUksSUFBSSxFQUFFO2FBQ3RDLENBQUM7U0FDSDtLQUNGO0lBRUQsT0FBTztRQUNMLEdBQUcsRUFBRTtZQUNILE1BQU0sRUFBRSxHQUFHLGVBQWUsV0FBVztZQUNyQyxPQUFPLEVBQUUsR0FBRyxpQkFBaUIsV0FBVztZQUN4QyxJQUFJLEVBQUUsR0FBRyxpQkFBaUIsV0FBVztZQUNyQyxPQUFPLEVBQUUsR0FBRyxlQUFlLFdBQVc7U0FDdkM7UUFDRCxZQUFZLEVBQUUsWUFBWTtRQUMxQixHQUFHLFlBQVk7S0FDaEIsQ0FBQztBQUNKLENBQUM7QUFuRUQsZ0NBbUVDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZ2xvYiB9IGZyb20gJ0Bzc2VuL3Byb21pc2VkJztcbmltcG9ydCB7IFBhY2thZ2VJbmZvIH0gZnJvbSAnLi4vdHlwZXMnO1xuaW1wb3J0IHR5cGUgeyBQYWNrYWdlSnNvbiB9IGZyb20gJ3R5cGUtZmVzdCc7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRFeHBvcnRzKFxuICBleHBvcnRzOiBQYWNrYWdlSW5mb1snZXhwb3J0cyddLFxuICBvdXREaXI6IHN0cmluZyxcbik6IFByb21pc2U8UGFja2FnZUpzb25bJ2V4cG9ydHMnXT4ge1xuICBjb25zdCByZXN1bHQgPSBhd2FpdCBnbG9iKGAqKi8qYCwge1xuICAgIGN3ZDogb3V0RGlyLFxuICAgIG5vZGlyOiB0cnVlLFxuICAgIGlnbm9yZTogWycqKi8qLmQudHMnLCAnKiovKi5qcy5tYXAnLCAncHVibGljLyonLCAnYmluLyonXSxcbiAgfSk7XG5cbiAgY29uc3QgZmlsZXMgPSBuZXcgU2V0KHJlc3VsdCk7XG5cbiAgY29uc3QgbW9kdWxlRGlyZWN0b3J5ID0gZXhwb3J0cy5tYWluID09PSAnbW9kdWxlJyA/ICcuJyA6ICcuL19tb2R1bGUnO1xuICBjb25zdCBjb21tb25qc0RpcmVjdG9yeSA9IGV4cG9ydHMubWFpbiA9PT0gJ21vZHVsZScgPyAnLi9fY29tbW9uanMnIDogJy4nO1xuICBjb25zdCBzZWNvbmRhcnkgPSBleHBvcnRzLm1haW4gPT09ICdtb2R1bGUnID8gJ2NvbW1vbmpzJyA6ICdtb2R1bGUnO1xuXG4gIGNvbnN0IGVudHJ5ID0gcmVzdWx0LmZpbHRlcihcbiAgICAoZmlsZSkgPT5cbiAgICAgICFmaWxlLnN0YXJ0c1dpdGgoJ19jb21tb25qcycpICYmXG4gICAgICAhZmlsZS5zdGFydHNXaXRoKCdfbW9kdWxlJykgJiZcbiAgICAgIGZpbGUgIT09ICdpbmRleC5qcycsXG4gICk7XG5cbiAgY29uc3QgZW50cnlFeHBvcnRzOiBQYWNrYWdlSnNvblsnZXhwb3J0cyddID0ge307XG5cbiAgZm9yIChjb25zdCBmaWxlIG9mIGVudHJ5KSB7XG4gICAgY29uc3Qga2V5ID0gYC4vJHtmaWxlLnJlcGxhY2UoLy5qcyQvLCAnJyl9YDtcblxuICAgIGlmICghZmlsZXMuaGFzKGBfJHtzZWNvbmRhcnl9LyR7ZmlsZX1gKSkge1xuICAgICAgZW50cnlFeHBvcnRzW2tleV0gPSBgLi8ke2ZpbGV9YDtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGVudHJ5RXhwb3J0c1trZXldID0ge1xuICAgICAgaW1wb3J0OiBgJHttb2R1bGVEaXJlY3Rvcnl9LyR7ZmlsZX1gLFxuICAgICAgcmVxdWlyZTogYCR7Y29tbW9uanNEaXJlY3Rvcnl9LyR7ZmlsZX1gLFxuICAgICAgbm9kZTogYCR7Y29tbW9uanNEaXJlY3Rvcnl9LyR7ZmlsZX1gLFxuICAgICAgZGVmYXVsdDogYCR7bW9kdWxlRGlyZWN0b3J5fS8ke2ZpbGV9YCxcbiAgICB9O1xuXG4gICAgZW50cnlFeHBvcnRzW2tleSArICcuanMnXSA9IHtcbiAgICAgIGltcG9ydDogYCR7bW9kdWxlRGlyZWN0b3J5fS8ke2ZpbGV9YCxcbiAgICAgIHJlcXVpcmU6IGAke2NvbW1vbmpzRGlyZWN0b3J5fS8ke2ZpbGV9YCxcbiAgICAgIG5vZGU6IGAke2NvbW1vbmpzRGlyZWN0b3J5fS8ke2ZpbGV9YCxcbiAgICAgIGRlZmF1bHQ6IGAke21vZHVsZURpcmVjdG9yeX0vJHtmaWxlfWAsXG4gICAgfTtcblxuICAgIGlmICgvXFwvaW5kZXgkLy50ZXN0KGtleSkpIHtcbiAgICAgIGVudHJ5RXhwb3J0c1trZXkucmVwbGFjZSgvXFwvaW5kZXgkLywgJycpXSA9IHtcbiAgICAgICAgaW1wb3J0OiBgJHttb2R1bGVEaXJlY3Rvcnl9LyR7ZmlsZX1gLFxuICAgICAgICByZXF1aXJlOiBgJHtjb21tb25qc0RpcmVjdG9yeX0vJHtmaWxlfWAsXG4gICAgICAgIG5vZGU6IGAke2NvbW1vbmpzRGlyZWN0b3J5fS8ke2ZpbGV9YCxcbiAgICAgICAgZGVmYXVsdDogYCR7bW9kdWxlRGlyZWN0b3J5fS8ke2ZpbGV9YCxcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHtcbiAgICAnLic6IHtcbiAgICAgIGltcG9ydDogYCR7bW9kdWxlRGlyZWN0b3J5fS9pbmRleC5qc2AsXG4gICAgICByZXF1aXJlOiBgJHtjb21tb25qc0RpcmVjdG9yeX0vaW5kZXguanNgLFxuICAgICAgbm9kZTogYCR7Y29tbW9uanNEaXJlY3Rvcnl9L2luZGV4LmpzYCxcbiAgICAgIGRlZmF1bHQ6IGAke21vZHVsZURpcmVjdG9yeX0vaW5kZXguanNgLFxuICAgIH0sXG4gICAgJy4vcHVibGljLyonOiAnLi9wdWJsaWMvKicsXG4gICAgLi4uZW50cnlFeHBvcnRzLFxuICB9O1xufVxuIl19