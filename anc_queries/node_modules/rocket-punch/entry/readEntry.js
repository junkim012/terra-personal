import fs from 'fs-extra';
import yaml from 'js-yaml';
import path from 'path';
import { packagesJsonFileName, packagesYamlFileName } from '../rule/fileNames';
export function readEntry({ cwd, }) {
    let packages = undefined;
    if (fs.existsSync(path.join(cwd, packagesJsonFileName))) {
        packages = fs.readJsonSync(path.join(cwd, packagesJsonFileName));
    }
    else if (fs.existsSync(path.join(cwd, packagesYamlFileName))) {
        const source = fs.readFileSync(path.join(cwd, packagesYamlFileName), {
            encoding: 'utf8',
        });
        const content = yaml.load(source);
        if (!content ||
            typeof content === 'string' ||
            typeof content === 'number') {
            throw new Error(`yaml.safeLoad does not return an object`);
        }
        packages = content;
    }
    if (!packages) {
        throw new Error(`could not find .packages.json or .packages.yaml files`);
    }
    const { 
    // ignore special keys
    $schema, ...entry } = packages;
    return entry;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVhZEVudHJ5LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL3JvY2tldC1wdW5jaC9lbnRyeS9yZWFkRW50cnkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBQzFCLE9BQU8sSUFBSSxNQUFNLFNBQVMsQ0FBQztBQUMzQixPQUFPLElBQUksTUFBTSxNQUFNLENBQUM7QUFDeEIsT0FBTyxFQUFFLG9CQUFvQixFQUFFLG9CQUFvQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFPL0UsTUFBTSxVQUFVLFNBQVMsQ0FBQyxFQUN4QixHQUFHLEdBQ0k7SUFDUCxJQUFJLFFBQVEsR0FBdUIsU0FBUyxDQUFDO0lBRTdDLElBQUksRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxvQkFBb0IsQ0FBQyxDQUFDLEVBQUU7UUFDdkQsUUFBUSxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsb0JBQW9CLENBQUMsQ0FBQyxDQUFDO0tBQ2xFO1NBQU0sSUFBSSxFQUFFLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLG9CQUFvQixDQUFDLENBQUMsRUFBRTtRQUM5RCxNQUFNLE1BQU0sR0FBVyxFQUFFLENBQUMsWUFBWSxDQUNwQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxvQkFBb0IsQ0FBQyxFQUNwQztZQUNFLFFBQVEsRUFBRSxNQUFNO1NBQ2pCLENBQ0YsQ0FBQztRQUVGLE1BQU0sT0FBTyxHQUFnRCxJQUFJLENBQUMsSUFBSSxDQUNwRSxNQUFNLENBQ1AsQ0FBQztRQUVGLElBQ0UsQ0FBQyxPQUFPO1lBQ1IsT0FBTyxPQUFPLEtBQUssUUFBUTtZQUMzQixPQUFPLE9BQU8sS0FBSyxRQUFRLEVBQzNCO1lBQ0EsTUFBTSxJQUFJLEtBQUssQ0FBQyx5Q0FBeUMsQ0FBQyxDQUFDO1NBQzVEO1FBRUQsUUFBUSxHQUFHLE9BQU8sQ0FBQztLQUNwQjtJQUVELElBQUksQ0FBQyxRQUFRLEVBQUU7UUFDYixNQUFNLElBQUksS0FBSyxDQUFDLHVEQUF1RCxDQUFDLENBQUM7S0FDMUU7SUFFRCxNQUFNO0lBQ0osc0JBQXNCO0lBQ3RCLE9BQU8sRUFDUCxHQUFHLEtBQUssRUFDVCxHQUFHLFFBQWtELENBQUM7SUFFdkQsT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGZzIGZyb20gJ2ZzLWV4dHJhJztcbmltcG9ydCB5YW1sIGZyb20gJ2pzLXlhbWwnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBwYWNrYWdlc0pzb25GaWxlTmFtZSwgcGFja2FnZXNZYW1sRmlsZU5hbWUgfSBmcm9tICcuLi9ydWxlL2ZpbGVOYW1lcyc7XG5pbXBvcnQgeyBQYWNrYWdlQ29uZmlnIH0gZnJvbSAnLi4vdHlwZXMnO1xuXG5pbnRlcmZhY2UgUGFyYW1zIHtcbiAgY3dkOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZWFkRW50cnkoe1xuICBjd2QsXG59OiBQYXJhbXMpOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmcgfCBQYWNrYWdlQ29uZmlnPiB7XG4gIGxldCBwYWNrYWdlczogb2JqZWN0IHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkO1xuXG4gIGlmIChmcy5leGlzdHNTeW5jKHBhdGguam9pbihjd2QsIHBhY2thZ2VzSnNvbkZpbGVOYW1lKSkpIHtcbiAgICBwYWNrYWdlcyA9IGZzLnJlYWRKc29uU3luYyhwYXRoLmpvaW4oY3dkLCBwYWNrYWdlc0pzb25GaWxlTmFtZSkpO1xuICB9IGVsc2UgaWYgKGZzLmV4aXN0c1N5bmMocGF0aC5qb2luKGN3ZCwgcGFja2FnZXNZYW1sRmlsZU5hbWUpKSkge1xuICAgIGNvbnN0IHNvdXJjZTogc3RyaW5nID0gZnMucmVhZEZpbGVTeW5jKFxuICAgICAgcGF0aC5qb2luKGN3ZCwgcGFja2FnZXNZYW1sRmlsZU5hbWUpLFxuICAgICAge1xuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgfSxcbiAgICApO1xuXG4gICAgY29uc3QgY29udGVudDogb2JqZWN0IHwgbnVtYmVyIHwgc3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZCA9IHlhbWwubG9hZChcbiAgICAgIHNvdXJjZSxcbiAgICApO1xuXG4gICAgaWYgKFxuICAgICAgIWNvbnRlbnQgfHxcbiAgICAgIHR5cGVvZiBjb250ZW50ID09PSAnc3RyaW5nJyB8fFxuICAgICAgdHlwZW9mIGNvbnRlbnQgPT09ICdudW1iZXInXG4gICAgKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYHlhbWwuc2FmZUxvYWQgZG9lcyBub3QgcmV0dXJuIGFuIG9iamVjdGApO1xuICAgIH1cblxuICAgIHBhY2thZ2VzID0gY29udGVudDtcbiAgfVxuXG4gIGlmICghcGFja2FnZXMpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYGNvdWxkIG5vdCBmaW5kIC5wYWNrYWdlcy5qc29uIG9yIC5wYWNrYWdlcy55YW1sIGZpbGVzYCk7XG4gIH1cblxuICBjb25zdCB7XG4gICAgLy8gaWdub3JlIHNwZWNpYWwga2V5c1xuICAgICRzY2hlbWEsXG4gICAgLi4uZW50cnlcbiAgfSA9IHBhY2thZ2VzIGFzIFJlY29yZDxzdHJpbmcsIHN0cmluZyB8IFBhY2thZ2VDb25maWc+O1xuXG4gIHJldHVybiBlbnRyeTtcbn1cbiJdfQ==