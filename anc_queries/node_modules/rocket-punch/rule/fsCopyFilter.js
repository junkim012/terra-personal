import { targetExtensions } from '@ssen/extended-compiler-host';
import fs from 'fs-extra';
const bundleExtensions = new RegExp(`.(${targetExtensions.join('|')})$`);
// if the file bundled by like `import text from './some.txt'`
// it does not copy
function isBundled(dest) {
    return bundleExtensions.test(dest) && fs.existsSync(dest + '.js');
}
// prettier-ignore
export function fsCopyFilter(src, dest) {
    const s = src.replace(/\\/g, '/');
    const completelyIgnore = /__(\w*)__/.test(s); // __tests__ , __fixtures__
    const ignore = /\.(ts|tsx|mjs|js|jsx)$/.test(s) || // *.ts, *.tsx, *.js, *.jsx, *.mjs
        isBundled(dest); // *.txt, *.md, *.yml...
    const pass = !completelyIgnore &&
        (!ignore ||
            /\.d\.ts$/.test(s) || // *.d.ts
            /\/bin\/[a-zA-Z0-9._-]+.js$/.test(s) || // bin/*.js
            /\/public\//.test(s) // public/*
        );
    //if (pass && !process.env.JEST_WORKER_ID) {
    //if (fs.statSync(s).isFile()) console.log('COPY:', s);
    //}
    return pass;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZnNDb3B5RmlsdGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL3JvY2tldC1wdW5jaC9ydWxlL2ZzQ29weUZpbHRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUNoRSxPQUFPLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFFMUIsTUFBTSxnQkFBZ0IsR0FBVyxJQUFJLE1BQU0sQ0FDekMsS0FBSyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FDcEMsQ0FBQztBQUVGLDhEQUE4RDtBQUM5RCxtQkFBbUI7QUFDbkIsU0FBUyxTQUFTLENBQUMsSUFBWTtJQUM3QixPQUFPLGdCQUFnQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsVUFBVSxDQUFDLElBQUksR0FBRyxLQUFLLENBQUMsQ0FBQztBQUNwRSxDQUFDO0FBRUQsa0JBQWtCO0FBQ2xCLE1BQU0sVUFBVSxZQUFZLENBQUMsR0FBVyxFQUFFLElBQVk7SUFDcEQsTUFBTSxDQUFDLEdBQVcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFFMUMsTUFBTSxnQkFBZ0IsR0FDcEIsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUEyQiwyQkFBMkI7SUFFNUUsTUFBTSxNQUFNLEdBQ1Ysd0JBQXdCLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFlLGtDQUFrQztRQUNqRixTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBK0Isd0JBQXdCO0lBRXpFLE1BQU0sSUFBSSxHQUNSLENBQUMsZ0JBQWdCO1FBQ2pCLENBQ0UsQ0FBQyxNQUFNO1lBQ1AsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBMkIsU0FBUztZQUN0RCw0QkFBNEIsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQVMsV0FBVztZQUN4RCxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUF5QixXQUFXO1NBQ3pELENBQUM7SUFFSiw0Q0FBNEM7SUFDNUMsdURBQXVEO0lBQ3ZELEdBQUc7SUFFSCxPQUFPLElBQUksQ0FBQztBQUNkLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB0YXJnZXRFeHRlbnNpb25zIH0gZnJvbSAnQHNzZW4vZXh0ZW5kZWQtY29tcGlsZXItaG9zdCc7XG5pbXBvcnQgZnMgZnJvbSAnZnMtZXh0cmEnO1xuXG5jb25zdCBidW5kbGVFeHRlbnNpb25zOiBSZWdFeHAgPSBuZXcgUmVnRXhwKFxuICBgLigke3RhcmdldEV4dGVuc2lvbnMuam9pbignfCcpfSkkYCxcbik7XG5cbi8vIGlmIHRoZSBmaWxlIGJ1bmRsZWQgYnkgbGlrZSBgaW1wb3J0IHRleHQgZnJvbSAnLi9zb21lLnR4dCdgXG4vLyBpdCBkb2VzIG5vdCBjb3B5XG5mdW5jdGlvbiBpc0J1bmRsZWQoZGVzdDogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHJldHVybiBidW5kbGVFeHRlbnNpb25zLnRlc3QoZGVzdCkgJiYgZnMuZXhpc3RzU3luYyhkZXN0ICsgJy5qcycpO1xufVxuXG4vLyBwcmV0dGllci1pZ25vcmVcbmV4cG9ydCBmdW5jdGlvbiBmc0NvcHlGaWx0ZXIoc3JjOiBzdHJpbmcsIGRlc3Q6IHN0cmluZyk6IGJvb2xlYW4ge1xuICBjb25zdCBzOiBzdHJpbmcgPSBzcmMucmVwbGFjZSgvXFxcXC9nLCAnLycpO1xuICBcbiAgY29uc3QgY29tcGxldGVseUlnbm9yZTogYm9vbGVhbiA9XG4gICAgL19fKFxcdyopX18vLnRlc3Qocyk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gX190ZXN0c19fICwgX19maXh0dXJlc19fXG4gIFxuICBjb25zdCBpZ25vcmU6IGJvb2xlYW4gPVxuICAgIC9cXC4odHN8dHN4fG1qc3xqc3xqc3gpJC8udGVzdChzKSB8fCAgICAgICAgICAgIC8vICoudHMsICoudHN4LCAqLmpzLCAqLmpzeCwgKi5tanNcbiAgICBpc0J1bmRsZWQoZGVzdCk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICoudHh0LCAqLm1kLCAqLnltbC4uLlxuICBcbiAgY29uc3QgcGFzczogYm9vbGVhbiA9XG4gICAgIWNvbXBsZXRlbHlJZ25vcmUgJiZcbiAgICAoXG4gICAgICAhaWdub3JlIHx8XG4gICAgICAvXFwuZFxcLnRzJC8udGVzdChzKSB8fCAgICAgICAgICAgICAgICAgICAgICAgIC8vICouZC50c1xuICAgICAgL1xcL2JpblxcL1thLXpBLVowLTkuXy1dKy5qcyQvLnRlc3QocykgfHwgICAgICAvLyBiaW4vKi5qc1xuICAgICAgL1xcL3B1YmxpY1xcLy8udGVzdChzKSAgICAgICAgICAgICAgICAgICAgICAgICAvLyBwdWJsaWMvKlxuICAgICk7XG4gIFxuICAvL2lmIChwYXNzICYmICFwcm9jZXNzLmVudi5KRVNUX1dPUktFUl9JRCkge1xuICAvL2lmIChmcy5zdGF0U3luYyhzKS5pc0ZpbGUoKSkgY29uc29sZS5sb2coJ0NPUFk6Jywgcyk7XG4gIC8vfVxuICBcbiAgcmV0dXJuIHBhc3M7XG59XG4iXX0=